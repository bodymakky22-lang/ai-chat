<!DOCTYPE html>
<html lang="ar" dir="rtl" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Makky Chat | Ù…ÙƒÙŠ ØªØ´Ø§Øª</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        deepBlue: '#1e3a8a',
                        deepBlueDark: '#0f172a',
                        slateGray: '#64748b',
                        slateGrayDark: '#334155'
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;700&display=swap');
        body { font-family: 'Cairo', sans-serif; }
        .markdown-content pre { background: #1e293b; padding: 1rem; border-radius: 0.5rem; margin: 0.5rem 0; overflow-x: auto; direction: ltr; }
        .markdown-content code { font-family: 'Consolas', monospace; color: #38bdf8; }
        .dot-flashing { position: relative; width: 8px; height: 8px; border-radius: 5px; background-color: #9ca3af; animation: dot-flashing 1s infinite linear alternate; animation-delay: 0.5s; }
        .dot-flashing::before, .dot-flashing::after { content: ''; display: inline-block; position: absolute; top: 0; width: 8px; height: 8px; border-radius: 5px; background-color: #9ca3af; animation: dot-flashing 1s infinite alternate; }
        .dot-flashing::before { left: -12px; animation-delay: 0s; }
        .dot-flashing::after { left: 12px; animation-delay: 1s; }
        @keyframes dot-flashing { 0% { background-color: #9ca3af; } 50%, 100% { background-color: rgba(156, 163, 175, 0.2); } }
    </style>
</head>
<body class="bg-gray-50 dark:bg-deepBlueDark text-gray-800 dark:text-gray-100 h-screen flex overflow-hidden transition-colors duration-300">

    <aside id="sidebar" class="bg-slate-200 dark:bg-slateGrayDark w-72 flex-shrink-0 flex flex-col transition-transform transform translate-x-full md:translate-x-0 absolute md:relative z-20 h-full border-l border-gray-300 dark:border-gray-700">
        <div class="p-4 flex items-center justify-between border-b border-gray-300 dark:border-gray-700">
            <h1 class="text-xl font-bold text-deepBlue dark:text-white">Makky Chat</h1>
            <button id="closeSidebar" class="md:hidden text-gray-500 hover:text-white">âœ•</button>
        </div>
        <div class="p-4 flex-1 overflow-y-auto">
            <button onclick="window.location.reload()" class="w-full flex items-center justify-center gap-2 bg-deepBlue hover:bg-blue-800 text-white py-2 px-4 rounded-lg transition-all">
                <span>+</span> Ù…Ø­Ø§Ø¯Ø«Ø© Ø¬Ø¯ÙŠØ¯Ø©
            </button>
            <div class="mt-8 space-y-4">
                <p class="text-xs font-semibold text-gray-500 uppercase">Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª Ø§Ù„Ø£Ø®ÙŠØ±Ø©</p>
                <div class="p-2 rounded hover:bg-gray-300 dark:hover:bg-slate-600 cursor-pointer text-sm truncate">ØªØ·ÙˆÙŠØ± ÙˆØ§Ø¬Ù‡Ø© Ù…Ø³ØªØ®Ø¯Ù…...</div>
            </div>
        </div>
    </aside>

    <main class="flex-1 flex flex-col h-full relative overflow-hidden">
        <header class="h-16 flex items-center justify-between px-6 border-b border-gray-300 dark:border-gray-700 bg-white dark:bg-deepBlueDark">
            <button id="openSidebar" class="md:hidden text-gray-500">â˜°</button>
            <div class="flex items-center gap-4">
                <button id="themeToggle" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-slate-700">
                    <span class="dark:hidden">ğŸŒ™</span><span class="hidden dark:inline">â˜€ï¸</span>
                </button>
            </div>
        </header>

        <div id="chatContainer" class="flex-1 overflow-y-auto p-4 space-y-6 pb-32 md:px-10 lg:px-24">
            <div class="flex items-start gap-4">
                <div class="w-10 h-10 rounded-full bg-deepBlue text-white flex items-center justify-center shadow-lg">AI</div>
                <div class="bg-white dark:bg-slateGrayDark p-4 rounded-2xl rounded-tr-none shadow-md max-w-[90%]">
                    Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙŠØ§ Ø¹Ø¨Ø¯ Ø§Ù„Ø±Ø­Ù…Ù†! Ø£Ù†Ø§ Makky ChatØŒ ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ ÙÙŠ Ø¨Ø±Ù…Ø¬ÙŠØ§ØªÙƒ Ø§Ù„ÙŠÙˆÙ…ØŸ
                </div>
            </div>
        </div>

        <div class="absolute bottom-0 left-0 w-full p-4 bg-gradient-to-t from-gray-50 dark:from-deepBlueDark">
            <div class="max-w-4xl mx-auto flex gap-2 items-end bg-white dark:bg-slateGray p-2 rounded-2xl shadow-xl border dark:border-gray-600">
                <textarea id="messageInput" rows="1" class="w-full bg-transparent p-2 focus:outline-none resize-none overflow-hidden max-h-40" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§..."></textarea>
                <button id="sendBtn" disabled class="p-3 bg-deepBlue text-white rounded-xl disabled:opacity-30">
                    <svg class="w-5 h-5 rotate-180" fill="currentColor" viewBox="0 0 20 20"><path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z"></path></svg>
                </button>
            </div>
        </div>
    </main>

    <script>
        // Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª - ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ Ø¥Ù„Ù‰ Gemini 2.5 Flash
        const API_KEY = "AIzaSyA2LS6SZMVQbn_V0uLyu794Nhtg_6Jrcv8";
        const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${API_KEY}`;

        const chatContainer = document.getElementById('chatContainer');
        const messageInput = document.getElementById('messageInput');
        const sendBtn = document.getElementById('sendBtn');

        // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ
        document.getElementById('themeToggle').addEventListener('click', () => document.documentElement.classList.toggle('dark'));

        // Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© Ù„Ù„Ø¬ÙˆØ§Ù„
        document.getElementById('openSidebar').onclick = () => document.getElementById('sidebar').classList.remove('translate-x-full');
        document.getElementById('closeSidebar').onclick = () => document.getElementById('sidebar').classList.add('translate-x-full');

        // ØªØºÙŠÙŠØ± Ø­Ø¬Ù… Ù…Ø±Ø¨Ø¹ Ø§Ù„Ù†Øµ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
        messageInput.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = (this.scrollHeight) + 'px';
            sendBtn.disabled = this.value.trim() === '';
        });

        async function sendMessage() {
            const text = messageInput.value.trim();
            if (!text) return;

            // Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            addMessage(text, true);
            messageInput.value = '';
            messageInput.style.height = 'auto';
            sendBtn.disabled = true;

            // Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„
            const loadingId = addLoading();

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: text }] }] })
                });

                const data = await response.json();
                document.getElementById(loadingId).remove();

                if (data.candidates && data.candidates[0].content.parts[0].text) {
                    addMessage(data.candidates[0].content.parts[0].text, false);
                } else {
                    addMessage("Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø±Ø¯.", false);
                }
            } catch (error) {
                document.getElementById(loadingId).remove();
                addMessage("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø´Ø¨ÙƒØ©.", false);
            }
        }

        function addMessage(text, isUser) {
            const div = document.createElement('div');
            div.className = `flex items-start gap-4 ${isUser ? 'flex-row-reverse' : ''}`;
            const htmlContent = isUser ? text : marked.parse(text);
            
            div.innerHTML = `
                <div class="w-10 h-10 rounded-full flex items-center justify-center font-bold shadow-md ${isUser ? 'bg-slateGray' : 'bg-deepBlue'} text-white">
                    ${isUser ? 'Ø£Ù†Øª' : 'AI'}
                </div>
                <div class="p-4 rounded-2xl shadow-sm max-w-[85%] markdown-content ${isUser ? 'bg-deepBlue text-white rounded-tl-none' : 'bg-white dark:bg-slateGrayDark text-gray-800 dark:text-gray-100 rounded-tr-none border dark:border-transparent'}">
                    ${htmlContent}
                </div>
            `;
            chatContainer.appendChild(div);
            chatContainer.scrollTo({ top: chatContainer.scrollHeight, behavior: 'smooth' });
        }

        function addLoading() {
            const id = 'load-' + Date.now();
            const div = document.createElement('div');
            div.id = id;
            div.className = "flex items-start gap-4";
            div.innerHTML = `
                <div class="w-10 h-10 rounded-full bg-deepBlue text-white flex items-center justify-center shadow-lg">AI</div>
                <div class="bg-white dark:bg-slateGrayDark p-6 rounded-2xl rounded-tr-none shadow-md flex items-center">
                    <div class="dot-flashing"></div>
                </div>`;
            chatContainer.appendChild(div);
            chatContainer.scrollTo({ top: chatContainer.scrollHeight, behavior: 'smooth' });
            return id;
        }

        sendBtn.onclick = sendMessage;
        messageInput.onkeydown = (e) => { if(e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendMessage(); } };
    </script>
</body>
</html>
